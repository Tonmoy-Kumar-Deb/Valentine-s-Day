<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Romantic Memory Game</title>
  <style>
  .game-title {
  margin-top: 90px;
  margin-bottom: 15px;
  color: #d00000;
  font-size: 22px;
  text-align: center;
}
    body {
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  background: #ffffff;
  position: relative;
  font-family: 'Courier New', monospace;
  color: #d00000;
  overflow: hidden;
  touch-action: manipulation;
  justify-content: center;
}
    button.back-btn {
  position: fixed;
  left: 15px;
  top: 15px;
  padding: 8px 18px;
  font-size: 14px;
  border: 2px solid #d00000;
  border-radius: 8px;
  background: #ffffff;
  color: #d00000;
  cursor: pointer;
  transition: 0.3s ease;
  z-index: 5;
}

button.back-btn:hover {
  background: #d00000;
  color: #ffffff;
}
    h1, h2 {
      color: #d00000;
      margin: 5px 0;
      position: relative;
      z-index: 1;
      margin-top: 50px;
    }
    #game {
  width: 90vmin;
  height: 90vmin;              /* Makes it perfect square */
  max-width: 400px;
  max-height: 400px;

  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(4, 1fr);

  gap: 3%;
  padding: 4%;

  border: 3px solid #d00000;
  border-radius: 16px;
  background: #ffffff;

  margin: auto;
  display: none;
  opacity: 0;
  transition: opacity 0.8s ease;

  box-sizing: border-box;
}
    .card {
  width: 100%;
  height: 100%;

  background: #d00000;
  border-radius: 12px;

  display: flex;
  justify-content: center;
  align-items: center;

  font-size: 6vmin;
  color: white;

  cursor: pointer;
  user-select: none;

  transition: all 0.25s ease;
    }

.card:hover {
  transform: scale(0.9);
}
    .card.show {
      opacity: 1;
      transform: scale(1);
    }
    .flipped {
  background: #ffffff;
  color: #d00000;
  border: 2px solid #d00000;
}
    .matched {
      visibility: hidden;
    }
    .modal {
      display: none;
      position: fixed;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .modal-content {
  background: #ffffff;
  padding: 25px;
  border-radius: 12px;
  border: 3px solid #d00000;
  color: #d00000;
  text-align: center;
  font-size: 18px;
}
   .modal-content a {
  color: #d00000;
  text-decoration: underline;
  cursor: pointer;
  margin: 0 10px;
}
    #startOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.95);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 20;
  flex-direction: column;
  color: #d00000;
}
    #startOverlay button {
  padding: 12px 28px;
  font-size: 20px;
  border: 2px solid #d00000;
  border-radius: 8px;
  background: #ffffff;
  color: #d00000;
  cursor: pointer;
  transition: 0.3s ease;
}

#startOverlay button:hover {
  background: #d00000;
  color: #ffffff;
}
  </style>
</head>
<body>
  <div id="startOverlay">
    <h2>Romantic Memory Game üíñ</h2>
    <button id="startBtn">Tap to Start</button>
  </div>

  <button class="back-btn" onclick="location.replace('calendar.html')">‚¨Ö Back</button>
  <h2 class="game-title">Match the Love Cards ‚ù§Ô∏è</h2>
  <div id="game"></div>

  <div class="modal" id="endModal">
    <div class="modal-content" id="modalText"></div>
  </div>



  <script>
    
    const allEmojis = ["‚ù§Ô∏è","üåπ","üç´","üíã","ü•∞","üíå","üå∏","üéÅ","üòç","üíñ"];
    const game = document.getElementById("game");
    let flippedCards = [];
    let matchedPairs = 0;
    const backgroundMusic = document.getElementById("backgroundMusic");
    const modal = document.getElementById("endModal");
    const modalText = document.getElementById("modalText");
    const startOverlay = document.getElementById("startOverlay");
    document.addEventListener("DOMContentLoaded", () => {
    const startBtn = document.getElementById("startBtn");

    startBtn.addEventListener("click", startGame);

    // Music setup
    let audio = new Audio("love.mp3");  
    audio.loop = true;  
    let savedTime = localStorage.getItem("musicTime");  
    let wasPlaying = localStorage.getItem("musicPlaying") === "true";  

    if (savedTime) { 
        audio.currentTime = parseFloat(savedTime); 
    }  

    if (wasPlaying) { 
        audio.play().catch(()=>{}); 
    }

    setInterval(() => { 
        localStorage.setItem("musicTime", audio.currentTime); 
    }, 1000);

    window.audio = audio; // make audio usable globally
});

    function startGame() {
  startOverlay.style.display = "none";  // hide overlay
  game.style.display = "grid";           // show game
  setTimeout(() => game.style.opacity = 1, 100);  // fade in
  playMusicFadeIn();                      // start music
  initializeCards();                      // create cards
    }

    function fadeInGame() {
      setTimeout(() => game.style.opacity = 1, 100);
    }

    function playMusicFadeIn() {
  audio.volume = 0;
  audio.play().catch(()=>{});
  let vol = 0;
  const fade = setInterval(() => {
    if (vol < 1) {
      vol += 0.05;
      audio.volume = vol;
    } else {
      clearInterval(fade);
    }
  }, 100);
    }

    function initializeCards() {
      const shuffled = allEmojis.sort(() => 0.5 - Math.random());
      const emojis = shuffled.slice(0,8);
      const symbols = [...emojis, ...emojis];
      symbols.sort(() => Math.random() - 0.5);

      symbols.forEach((sym, index) => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.index = index;
        card.textContent = "?";
        card.onclick = () => flipCard(card, sym);
        game.appendChild(card);
        setTimeout(() => card.classList.add("show"), 100 * index);
      });
    }

    function flipCard(card, symbol) {
      if (flippedCards.length < 2 &&
          !card.classList.contains("flipped") &&
          !card.classList.contains("matched")) {

        card.textContent = symbol;
        card.classList.add("flipped");
        flippedCards.push({ card, symbol });

        if (flippedCards.length === 2) {
          if (flippedCards[0].symbol === flippedCards[1].symbol) {
            setTimeout(() => {
              flippedCards[0].card.classList.add("matched");
              flippedCards[1].card.classList.add("matched");
              matchedPairs++;
              flippedCards = [];
              if (matchedPairs === 8) {
                modal.style.display = "flex";
                modalText.innerHTML = `
                  <p>üéâ Congratulations! You matched all cards!</p>
       <p>
  <a onclick="location.reload()">Replay</a> | 
  <a onclick="exitGame()">Exit</a>
</p>
                `;
              }
            }, 1000);
          } else {
            setTimeout(() => {
              flippedCards[0].card.textContent = "?";
              flippedCards[1].card.textContent = "?";
              flippedCards[0].card.classList.remove("flipped");
              flippedCards[1].card.classList.remove("flipped");
              flippedCards = [];
            }, 1000);
          }
        }
      }
    }

    function exitGame() {
    // Fade out music
    let vol = audio.volume;
    const fade = setInterval(() => {
        if (vol > 0) {
            vol -= 0.05;
            audio.volume = vol;
        } else {
            audio.pause();
            audio.currentTime = 0;
            clearInterval(fade);
        }
    }, 50);

    // Show thank you text in modal
    modalText.innerHTML = "<p>Thank you for playing ‚ù§Ô∏è</p>";

    // Redirect after 2 seconds
    setTimeout(() => {
        location.replace("calendar.html");
    }, 2000);
    }

    function fadeOutMusic() {
      let vol = backgroundMusic.volume;
      const fade = setInterval(() => {
        if (vol > 0) {
          vol -= 0.05;
          backgroundMusic.volume = vol;
        } else {
          backgroundMusic.pause();
          backgroundMusic.currentTime = 0;
          clearInterval(fade);
        }
      }, 100);
    }
    

function toggleMusic() {
    const btn = document.getElementById("musicBtn");

    if (!audio.paused) {
        audio.pause();
        btn.innerText = "üéµ OFF";
        localStorage.setItem("musicPlaying", "false");
    } else {
        audio.play();
        btn.innerText = "üéµ ON";
        localStorage.setItem("musicPlaying", "true");
    }
}

setInterval(() => {
    localStorage.setItem("musicTime", audio.currentTime);
}, 1000);
  </script>
</body>
</html>
